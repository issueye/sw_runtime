# SW Runtime æµ‹è¯•å¥—ä»¶

è¿™ä¸ªæµ‹è¯•å¥—ä»¶ä¸º SW Runtime é¡¹ç›®æä¾›äº†å…¨é¢çš„æµ‹è¯•è¦†ç›–ï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œæ€§èƒ½åŸºå‡†æµ‹è¯•ã€‚

## æµ‹è¯•æ–‡ä»¶ç»“æ„

### æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•

- **`runner_test.go`** - è¿è¡Œå™¨æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
  - åŸºæœ¬ JavaScript ä»£ç æ‰§è¡Œ
  - TypeScript æ”¯æŒå’Œç¼–è¯‘
  - æ§åˆ¶å°è¾“å‡ºåŠŸèƒ½
  - å…¨å±€å˜é‡ç®¡ç†
  - å¼‚æ­¥æ“ä½œæ”¯æŒ
  - Promise æ‰§è¡Œ
  - æ¨¡å—ç³»ç»Ÿé›†æˆ
  - é”™è¯¯å¤„ç†
  - æ¨¡å—ç¼“å­˜ç®¡ç†

- **`builtins_test.go`** - å†…ç½®æ¨¡å—æµ‹è¯•
  - å†…ç½®æ¨¡å—ç®¡ç†å™¨åŠŸèƒ½
  - Path æ¨¡å—åŠŸèƒ½
  - æ–‡ä»¶ç³»ç»Ÿæ¨¡å—
  - åŠ å¯†æ¨¡å—
  - HTTP æ¨¡å—
  - å‹ç¼©æ¨¡å—
  - è‡ªå®šä¹‰æ¨¡å—æ³¨å†Œ

- **`eventloop_test.go`** - äº‹ä»¶å¾ªç¯æµ‹è¯•
  - åŸºæœ¬å®šæ—¶å™¨åŠŸèƒ½
  - é—´éš”å®šæ—¶å™¨
  - å®šæ—¶å™¨æ¸…é™¤
  - å¤šä¸ªå®šæ—¶å™¨åè°ƒ
  - åµŒå¥—å®šæ—¶å™¨
  - Promise é›†æˆ
  - é”™è¯¯å¤„ç†

- **`modules_test.go`** - æ¨¡å—ç³»ç»Ÿæµ‹è¯•
  - åŸºæœ¬ require åŠŸèƒ½
  - æ–‡ä»¶æ¨¡å—åŠ è½½
  - TypeScript æ¨¡å—æ”¯æŒ
  - å¾ªç¯ä¾èµ–å¤„ç†
  - æ¨¡å—ç¼“å­˜æœºåˆ¶
  - åŠ¨æ€ import æ”¯æŒ

### é›†æˆæµ‹è¯•

- **`integration_test.go`** - é›†æˆæµ‹è¯•
  - åŸºæœ¬åº”ç”¨ç¨‹åºé›†æˆ
  - å¼‚æ­¥æ“ä½œé›†æˆ
  - æ¨¡å—é—´äº¤äº’
  - é”™è¯¯æ¢å¤æœºåˆ¶
  - å¤æ‚åº”ç”¨ç¨‹åºåœºæ™¯

### æ€§èƒ½æµ‹è¯•

- **`benchmark_test.go`** - æ€§èƒ½åŸºå‡†æµ‹è¯•
  - åŸºæœ¬ä»£ç æ‰§è¡Œæ€§èƒ½
  - TypeScript ç¼–è¯‘æ€§èƒ½
  - æ¨¡å—åŠ è½½æ€§èƒ½
  - å¼‚æ­¥æ“ä½œæ€§èƒ½
  - Promise æ‰§è¡Œæ€§èƒ½
  - å¤æ‚è®¡ç®—æ€§èƒ½
  - å¯¹è±¡æ“ä½œæ€§èƒ½
  - å­—ç¬¦ä¸²æ“ä½œæ€§èƒ½
  - å†…å­˜ä½¿ç”¨æµ‹è¯•
  - å¹¶å‘æ“ä½œæ€§èƒ½

- **`vmprocessor_performance_test.go`** - VMProcessor æ€§èƒ½æµ‹è¯• â­ **NEW**
  - ä¸²è¡Œè¯·æ±‚æ€§èƒ½æµ‹è¯•
  - å¹¶å‘è¯·æ±‚æ€§èƒ½æµ‹è¯•ï¼ˆå³°å€¼ 22,921 req/sï¼‰
  - é«˜å¹¶å‘å‹åŠ›æµ‹è¯•ï¼ˆ50 å¹¶å‘ï¼‰
  - æ··åˆè·¯ç”±æ€§èƒ½æµ‹è¯•
  - é•¿æ—¶é—´ç¨³å®šæ€§æµ‹è¯•ï¼ˆ10 ç§’æŒç»­å‹åŠ›ï¼‰
  - **ğŸ“Š è¯¦ç»†æŠ¥å‘Š**: [VMPROCESSOR_PERFORMANCE_REPORT.md](VMPROCESSOR_PERFORMANCE_REPORT.md)

## è¿è¡Œæµ‹è¯•

### å¿«é€Ÿæµ‹è¯•ï¼ˆæ¨èï¼ŒCI ä½¿ç”¨ï¼‰
> è·³è¿‡è€—æ—¶è¾ƒé•¿çš„å‹æµ‹å’Œæ€§èƒ½æµ‹è¯•ï¼Œç”¨äºæ—¥å¸¸å¼€å‘å’ŒæŒç»­é›†æˆã€‚
```bash
go test -short ./test/...
```

### å…¨é‡æµ‹è¯•ï¼ˆåŒ…å«å‹æµ‹ï¼Œå¯èƒ½è€—æ—¶è¾ƒé•¿ï¼‰
```bash
go test ./test/...
```

### è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
```bash
go test ./test/runner_test.go
go test ./test/builtins_test.go
go test ./test/eventloop_test.go
go test ./test/modules_test.go
go test ./test/integration_test.go
```

### è¿è¡Œæ€§èƒ½åŸºå‡†æµ‹è¯•ï¼ˆå‹æµ‹ï¼‰
```bash
# æŒ‰éœ€åœ¨æœ¬åœ°æˆ–ä¸“é—¨çš„æ€§èƒ½ç¯å¢ƒä¸­è¿è¡Œ
go test -bench=BenchmarkRunner ./test/benchmark_test.go -benchtime=1s
```

### è¿è¡Œ VMProcessor æ€§èƒ½æµ‹è¯• / å‹æµ‹
```bash
# å®Œæ•´ VMProcessor å‹æµ‹å¥—ä»¶ï¼ˆåŒ…å«é«˜å¹¶å‘ä¸é•¿æ—¶é—´ç¨³å®šæ€§ï¼‰
go test -v ./test -run "TestVMProcessorPerformance" -count=1 -timeout=5m
```

æŸ¥çœ‹è¯¦ç»†æ€§èƒ½æŠ¥å‘Š: [test/VMPROCESSOR_PERFORMANCE_REPORT.md](VMPROCESSOR_PERFORMANCE_REPORT.md)

### è¿è¡Œç‰¹å®šçš„åŸºå‡†æµ‹è¯•
```bash
go test -bench=BenchmarkRunnerBasicExecution ./test/benchmark_test.go
go test -bench=BenchmarkRunnerTypeScriptCompilation ./test/benchmark_test.go
```

### è¯¦ç»†è¾“å‡º
```bash
go test -v ./test/...
```

### æµ‹è¯•è¦†ç›–ç‡
```bash
go test -cover ./test/...
go test -coverprofile=coverage.out ./test/...
go tool cover -html=coverage.out
```

## æµ‹è¯•ç‰¹æ€§

### åŠŸèƒ½æµ‹è¯•è¦†ç›–
- âœ… JavaScript/TypeScript ä»£ç æ‰§è¡Œ
- âœ… æ¨¡å—ç³»ç»Ÿï¼ˆrequire/importï¼‰
- âœ… å¼‚æ­¥æ“ä½œï¼ˆsetTimeout/setIntervalï¼‰
- âœ… Promise æ”¯æŒ
- âœ… äº‹ä»¶å¾ªç¯æœºåˆ¶
- âœ… å†…ç½®æ¨¡å—åŠŸèƒ½
- âœ… é”™è¯¯å¤„ç†å’Œæ¢å¤
- âœ… æ¨¡å—ç¼“å­˜æœºåˆ¶
- âœ… å¾ªç¯ä¾èµ–å¤„ç†
- âœ… åŠ¨æ€æ¨¡å—åŠ è½½

### æ€§èƒ½æµ‹è¯•è¦†ç›–
- âœ… ä»£ç æ‰§è¡Œé€Ÿåº¦
- âœ… TypeScript ç¼–è¯‘æ€§èƒ½
- âœ… æ¨¡å—åŠ è½½æ•ˆç‡
- âœ… å¼‚æ­¥æ“ä½œå¼€é”€
- âœ… å†…å­˜ä½¿ç”¨æƒ…å†µ
- âœ… å¹¶å‘å¤„ç†èƒ½åŠ›

### é›†æˆæµ‹è¯•è¦†ç›–
- âœ… å®Œæ•´åº”ç”¨ç¨‹åºæµç¨‹
- âœ… å¤šæ¨¡å—åä½œ
- âœ… å¤æ‚å¼‚æ­¥åœºæ™¯
- âœ… é”™è¯¯æ¢å¤æµç¨‹
- âœ… å®é™…ä½¿ç”¨åœºæ™¯æ¨¡æ‹Ÿ

## æµ‹è¯•æ•°æ®å’Œä¸´æ—¶æ–‡ä»¶

æµ‹è¯•è¿‡ç¨‹ä¸­ä¼šåˆ›å»ºä¸´æ—¶æ–‡ä»¶å’Œç›®å½•ï¼Œè¿™äº›éƒ½ä¼šåœ¨æµ‹è¯•å®Œæˆåè‡ªåŠ¨æ¸…ç†ã€‚æµ‹è¯•ä½¿ç”¨ Go çš„ `t.TempDir()` æ¥åˆ›å»ºä¸´æ—¶ç›®å½•ï¼Œç¡®ä¿æµ‹è¯•ç¯å¢ƒçš„éš”ç¦»å’Œæ¸…æ´ã€‚

## æŒç»­é›†æˆ

è¿™äº›æµ‹è¯•å¯ä»¥è½»æ¾é›†æˆåˆ° CI/CD æµæ°´çº¿ä¸­ï¼š

```yaml
# GitHub Actions ç¤ºä¾‹
- name: Run Tests (fast)
  run: |
    # ä»…è¿è¡ŒåŠŸèƒ½/é›†æˆæµ‹è¯•ï¼Œè·³è¿‡å‹æµ‹ä¸é‡å‹æ€§èƒ½æµ‹è¯•
    go test -short -v ./test/...

- name: Generate Coverage Report
  run: |
    go test -short -coverprofile=coverage.out ./test/...
    go tool cover -html=coverage.out -o coverage.html

# å¯é€‰ï¼šåœ¨ä¸“é—¨çš„æ€§èƒ½ Job ä¸­è¿è¡Œå‹æµ‹
- name: Run Performance & Stress Tests (optional)
  if: github.event_name == 'workflow_dispatch'
  run: |
    go test -v ./test -run "TestVMProcessorPerformance" -count=1 -timeout=5m
    go test -bench=BenchmarkRunner ./test/benchmark_test.go -benchtime=1s
```

## è´¡çŒ®æŒ‡å—

æ·»åŠ æ–°æµ‹è¯•æ—¶è¯·éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

1. **æµ‹è¯•å‘½å**ï¼šä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•å‡½æ•°å
2. **æµ‹è¯•éš”ç¦»**ï¼šæ¯ä¸ªæµ‹è¯•åº”è¯¥ç‹¬ç«‹è¿è¡Œ
3. **æ¸…ç†èµ„æº**ï¼šä½¿ç”¨ `defer` æˆ– `t.Cleanup()` æ¸…ç†èµ„æº
4. **é”™è¯¯å¤„ç†**ï¼šä½¿ç”¨ `t.Fatalf()` å¤„ç†è‡´å‘½é”™è¯¯ï¼Œ`t.Errorf()` å¤„ç†éè‡´å‘½é”™è¯¯
5. **æ–‡æ¡£**ï¼šä¸ºå¤æ‚æµ‹è¯•æ·»åŠ æ³¨é‡Šè¯´æ˜

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æµ‹è¯•è¶…æ—¶**ï¼šå¢åŠ å¼‚æ­¥æ“ä½œçš„ç­‰å¾…æ—¶é—´
2. **æ–‡ä»¶æƒé™**ï¼šç¡®ä¿æµ‹è¯•æœ‰æƒé™åˆ›å»ºä¸´æ—¶æ–‡ä»¶
3. **æ¨¡å—è·¯å¾„**ï¼šæ£€æŸ¥æ¨¡å—å¯¼å…¥è·¯å¾„æ˜¯å¦æ­£ç¡®
4. **ä¾èµ–ç¼ºå¤±**ï¼šç¡®ä¿æ‰€æœ‰ä¾èµ–éƒ½å·²å®‰è£…

### è°ƒè¯•æŠ€å·§

1. ä½¿ç”¨ `t.Logf()` æ·»åŠ è°ƒè¯•è¾“å‡º
2. ä½¿ç”¨ `-v` æ ‡å¿—æŸ¥çœ‹è¯¦ç»†è¾“å‡º
3. å•ç‹¬è¿è¡Œå¤±è´¥çš„æµ‹è¯•è¿›è¡Œè°ƒè¯•
4. æ£€æŸ¥ä¸´æ—¶æ–‡ä»¶å†…å®¹ï¼ˆåœ¨æ¸…ç†å‰ï¼‰