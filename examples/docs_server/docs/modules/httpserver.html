<section id="httpserver" class="content-section">
    <h2 class="section-title">HTTPæœåŠ¡å™¨æ¨¡å— (httpserver)</h2>
    
    <div class="module-intro">
        <h3>httpserver / server</h3>
        <p>æä¾›å®Œæ•´çš„HTTPæœåŠ¡å™¨åŠŸèƒ½ï¼Œæ”¯æŒè·¯ç”±ã€ä¸­é—´ä»¶ã€é™æ€æ–‡ä»¶æœåŠ¡ç­‰ã€‚</p>
    </div>

    <div class="api-method">
        <div class="method-header">
            <span class="method-signature">httpserver.createServer(): HttpServer</span>
            <div class="method-badges">
                <span class="badge badge-sync">åŒæ­¥</span>
            </div>
        </div>
        <div class="method-content">
            <div class="method-description">åˆ›å»ºHTTPæœåŠ¡å™¨å®ä¾‹ã€‚</div>
            
            <div class="returns-section">
                <div class="section-subtitle">è¿”å›å€¼</div>
                <div class="return-type">HttpServer - æœåŠ¡å™¨å®ä¾‹å¯¹è±¡</div>
            </div>

            <div class="code-example">
const server = require('httpserver');
const app = server.createServer();

// æˆ–è€…ä½¿ç”¨åˆ«å
const httpserver = require('server');
const app2 = httpserver.createServer();
            </div>
        </div>
    </div>

    <div class="api-method">
        <div class="method-header">
            <span class="method-signature">app.get(path: string, handler: Function): void</span>
            <div class="method-badges">
                <span class="badge badge-sync">åŒæ­¥</span>
            </div>
        </div>
        <div class="method-content">
            <div class="method-description">æ³¨å†ŒGETè·¯ç”±å¤„ç†å™¨ã€‚</div>
            
            <div class="params-section">
                <div class="section-subtitle">å‚æ•°</div>
                <div class="param-item">
                    <div class="param-header">
                        <span class="param-name">path</span>
                        <span class="param-type">string</span>
                        <span class="param-required">å¿…éœ€</span>
                    </div>
                    <div class="param-description">è·¯ç”±è·¯å¾„</div>
                </div>
                <div class="param-item">
                    <div class="param-header">
                        <span class="param-name">handler</span>
                        <span class="param-type">Function</span>
                        <span class="param-required">å¿…éœ€</span>
                    </div>
                    <div class="param-description">è·¯ç”±å¤„ç†å‡½æ•° (req, res) => {}</div>
                </div>
            </div>

            <div class="code-example">
// åŸºæœ¬è·¯ç”±
app.get('/', (req, res) => {
  res.html('<h1>æ¬¢è¿ä½¿ç”¨ SW Runtime!</h1>');
});

// API è·¯ç”±
app.get('/api/users', (req, res) => {
  const users = [
    { id: 1, name: 'å¼ ä¸‰', email: 'zhangsan@example.com' },
    { id: 2, name: 'æå››', email: 'lisi@example.com' }
  ];
  
  res.json({
    success: true,
    data: users,
    total: users.length
  });
});

// å¸¦æŸ¥è¯¢å‚æ•°çš„è·¯ç”±
app.get('/api/search', (req, res) => {
  const query = req.params.q || '';
  const page = parseInt(req.params.page) || 1;
  
  res.json({
    query: query,
    page: page,
    results: []
  });
});
            </div>
        </div>
    </div>

    <div class="api-method">
        <div class="method-header">
            <span class="method-signature">app.post(path: string, handler: Function): void</span>
            <div class="method-badges">
                <span class="badge badge-sync">åŒæ­¥</span>
            </div>
        </div>
        <div class="method-content">
            <div class="method-description">æ³¨å†ŒPOSTè·¯ç”±å¤„ç†å™¨ã€‚</div>
            
            <div class="code-example">
// å¤„ç† JSON æ•°æ®
app.post('/api/users', (req, res) => {
  const userData = req.json; // è‡ªåŠ¨è§£æçš„JSONæ•°æ®
  
  // éªŒè¯æ•°æ®
  if (!userData.name || !userData.email) {
    return res.status(400).json({
      error: 'ç¼ºå°‘å¿…éœ€å­—æ®µ',
      required: ['name', 'email']
    });
  }
  
  // æ¨¡æ‹Ÿä¿å­˜ç”¨æˆ·
  const newUser = {
    id: Date.now(),
    name: userData.name,
    email: userData.email,
    createdAt: new Date().toISOString()
  };
  
  console.log('åˆ›å»ºç”¨æˆ·:', newUser);
  
  res.status(201).json({
    success: true,
    message: 'ç”¨æˆ·åˆ›å»ºæˆåŠŸ',
    data: newUser
  });
});

// å¤„ç†æ–‡ä»¶ä¸Šä¼ æˆ–è¡¨å•æ•°æ®
app.post('/api/upload', (req, res) => {
  const contentType = req.headers['content-type'];
  
  if (contentType.includes('application/json')) {
    console.log('JSON æ•°æ®:', req.json);
  } else {
    console.log('åŸå§‹æ•°æ®:', req.body);
  }
  
  res.json({ message: 'æ•°æ®æ¥æ”¶æˆåŠŸ' });
});
            </div>
        </div>
    </div>

    <div class="api-method">
        <div class="method-header">
            <span class="method-signature">app.use(middleware: Function): void</span>
            <div class="method-badges">
                <span class="badge badge-sync">åŒæ­¥</span>
            </div>
        </div>
        <div class="method-content">
            <div class="method-description">æ·»åŠ ä¸­é—´ä»¶å‡½æ•°ã€‚</div>
            
            <div class="code-example">
// æ—¥å¿—ä¸­é—´ä»¶
app.use((req, res, next) => {
  const timestamp = new Date().toISOString();
  console.log(`[${timestamp}] ${req.method} ${req.path}`);
  
  // æ·»åŠ è‡ªå®šä¹‰å“åº”å¤´
  res.header('X-Powered-By', 'SW-Runtime');
  res.header('X-Response-Time', Date.now());
  
  next(); // è°ƒç”¨ä¸‹ä¸€ä¸ªä¸­é—´ä»¶
});

// CORS ä¸­é—´ä»¶
app.use((req, res, next) => {
  res.header('Access-Control-Allow-Origin', '*');
  res.header('Access-Control-Allow-Methods', 'GET,POST,PUT,DELETE,OPTIONS');
  res.header('Access-Control-Allow-Headers', 'Content-Type,Authorization');
  
  // å¤„ç†é¢„æ£€è¯·æ±‚
  if (req.method === 'OPTIONS') {
    return res.status(200).send('OK');
  }
  
  next();
});

// è®¤è¯ä¸­é—´ä»¶
app.use((req, res, next) => {
  // è·³è¿‡å…¬å¼€è·¯å¾„
  if (req.path.startsWith('/public') || req.path === '/login') {
    return next();
  }
  
  const token = req.headers['authorization'];
  if (!token) {
    return res.status(401).json({ error: 'æœªæä¾›è®¤è¯ä»¤ç‰Œ' });
  }
  
  // éªŒè¯ä»¤ç‰Œï¼ˆç®€åŒ–ç¤ºä¾‹ï¼‰
  if (token !== 'Bearer valid-token') {
    return res.status(403).json({ error: 'æ— æ•ˆçš„è®¤è¯ä»¤ç‰Œ' });
  }
  
  next();
});
            </div>
        </div>
    </div>

    <div class="api-method">
        <div class="method-header">
            <span class="method-signature">app.listen(port: string): Promise&lt;string&gt;</span>
            <div class="method-badges">
                <span class="badge badge-async">å¼‚æ­¥</span>
                <span class="badge badge-promise">Promise</span>
            </div>
        </div>
        <div class="method-content">
            <div class="method-description">å¯åŠ¨HTTPæœåŠ¡å™¨ã€‚</div>
            
            <div class="code-example">
// å¯åŠ¨æœåŠ¡å™¨
app.listen('3000')
  .then(result => {
    console.log('ğŸš€ æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ:', result);
    console.log('ğŸ“ è®¿é—®åœ°å€: http://localhost:3000');
  })
  .catch(error => {
    console.error('âŒ æœåŠ¡å™¨å¯åŠ¨å¤±è´¥:', error);
  });

// ä½¿ç”¨ async/await
async function startServer() {
  try {
    const result = await app.listen('8080');
    console.log('æœåŠ¡å™¨è¿è¡Œåœ¨:', result);
  } catch (error) {
    console.error('å¯åŠ¨å¤±è´¥:', error);
    process.exit(1);
  }
}

startServer();
            </div>
        </div>
    </div>
</section>